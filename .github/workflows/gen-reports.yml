name: Generate reports

on:
  # Run if files that could be relevant change.
  push:
    branches:
    - master
    paths:
    - flake.*
    - .github/workflows/gen-report.yml
    - .github/workflows/gen-reports.yml

  # Run hourly.
  schedule:
   - cron: '0 */1 * * *'

# Don't run until the `./rm-reports.yml` workflow is finished running.
concurrency: rm-reports

jobs:
  nixpkgs-trunk:
    name: nixpkgs-trunk
    uses: ./.github/workflows/gen-report.yml
    with:
      project: nixpkgs
      jobset: trunk
  nixpkgs-nixpkgs-unstable-aarch64-darwin:
    name: nixpkgs-unstable-aarch64-darwin
    uses: ./.github/workflows/gen-report.yml
    with:
      project: nixpkgs
      jobset: nixpkgs-unstable-aarch64-darwin
  nixpkgs-nixpkgs-22_11-darwin:
    name: nixpkgs-22.11-darwin
    uses: ./.github/workflows/gen-report.yml
    with:
      project: nixpkgs
      jobset: nixpkgs-22.11-darwin
  nixpkgs-python-updates:
    name: python-updates
    uses: ./.github/workflows/gen-report.yml
    with:
      project: nixpkgs
      jobset: python-updates
  nixpkgs-staging-next:
    uses: ./.github/workflows/gen-report.yml
    with:
      project: nixpkgs
      jobset: staging-next
  nixpkgs-staging-next-22_11:
    name: staging-next-22.11
    uses: ./.github/workflows/gen-report.yml
    with:
      project: nixpkgs
      jobset: staging-next-22.11

  nixos-trunk-combined:
    name: nixos-trunk-combined
    uses: ./.github/workflows/gen-report.yml
    with:
      project: nixos
      jobset: trunk-combined
  nixos-release-22_11:
    name: release-22.11
    uses: ./.github/workflows/gen-report.yml
    with:
      project: nixos
      jobset: release-22.11
